<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uzbekistan Topography - Day 5 Earth</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            color: white;
            overflow: hidden;
        }

        #container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            height: 100vh;
            gap: 0;
        }

        #map-2d {
            background: #0f3460;
            position: relative;
            border-right: 3px solid #16213e;
        }

        #map-3d {
            background: linear-gradient(135deg, #0f3460 0%, #16213e 100%);
            position: relative;
        }

        .panel {
            position: absolute;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 10px;
            z-index: 100;
        }

        .title {
            top: 20px;
            left: 20px;
            max-width: 350px;
        }

        .title h1 {
            font-size: 28px;
            margin-bottom: 10px;
            color: #e94560;
        }

        .title h2 {
            font-size: 16px;
            color: #aaa;
            margin-bottom: 15px;
            font-weight: normal;
        }

        .legend {
            bottom: 20px;
            left: 20px;
            max-width: 300px;
        }

        .legend h3 {
            font-size: 18px;
            margin-bottom: 15px;
            border-bottom: 2px solid #e94560;
            padding-bottom: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
            font-size: 14px;
        }

        .legend-color {
            width: 30px;
            height: 20px;
            margin-right: 12px;
            border-radius: 4px;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .controls {
            top: 20px;
            right: 20px;
            max-width: 250px;
        }

        .controls h3 {
            font-size: 16px;
            margin-bottom: 12px;
            color: #e94560;
        }

        .controls p {
            font-size: 13px;
            margin: 6px 0;
            color: #ccc;
        }

        .region-label {
            position: absolute;
            color: white;
            font-size: 12px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            pointer-events: none;
            z-index: 10;
        }

        .city-marker {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #e94560;
            border: 2px solid white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 5;
        }

        .city-label {
            position: absolute;
            color: white;
            font-size: 11px;
            font-weight: 600;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.9);
            transform: translate(6px, -12px);
            white-space: nowrap;
            pointer-events: none;
        }

        svg {
            width: 100%;
            height: 100%;
        }

        .country-boundary {
            fill: none;
            stroke: #e94560;
            stroke-width: 3;
            stroke-linejoin: round;
        }

        .topography-region {
            opacity: 0.8;
            stroke: rgba(255,255,255,0.3);
            stroke-width: 1;
        }

        .view-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            color: rgba(255,255,255,0.1);
            font-weight: bold;
            pointer-events: none;
            z-index: 1;
        }
    </style>
</head>
<body>
    <div id="container">
        <!-- 2D Map View -->
        <div id="map-2d">
            <div class="view-label">2D TOPOGRAPHY</div>

            <div class="panel title">
                <h1>üó∫Ô∏è Uzbekistan Topography</h1>
                <h2>Day 5 - Earth</h2>
                <p>Interactive visualization showing diverse terrain from desert lowlands to mountain peaks</p>
            </div>

            <div class="panel legend">
                <h3>Topographic Regions</h3>
                <div class="legend-item">
                    <div class="legend-color" style="background: #8B4513;"></div>
                    <span>Tian Shan Mountains (East)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #A0522D;"></div>
                    <span>Pamir-Alay Range (South)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #D2691E;"></div>
                    <span>Fergana Valley (East)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #DAA520;"></div>
                    <span>Kyzylkum Desert (Center)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #DEB887;"></div>
                    <span>Ustyurt Plateau (West)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #90EE90;"></div>
                    <span>River Valleys (Amu Darya, Syr Darya)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #4682B4;"></div>
                    <span>Aral Sea Basin (Northwest)</span>
                </div>
            </div>

            <svg id="svg-map" viewBox="0 0 800 600"></svg>
        </div>

        <!-- 3D View -->
        <div id="map-3d">
            <div class="view-label">3D TERRAIN</div>

            <div class="panel controls">
                <h3>üéÆ 3D Controls</h3>
                <p>üñ±Ô∏è Drag: Rotate view</p>
                <p>üñ±Ô∏è Scroll: Zoom in/out</p>
                <p>üñ±Ô∏è Right-drag: Pan</p>
                <br>
                <h3>üìä Elevation Range</h3>
                <p>Highest: 4,643m (Khazret Sultan)</p>
                <p>Lowest: -12m (Aral Sea)</p>
                <p>Range: 4,655m</p>
            </div>
        </div>
    </div>

    <script>
        // Uzbekistan coordinates (simplified boundary)
        const uzbekistanBoundary = [
            [56.0, 41.2], [61.0, 41.2], [62.5, 42.5], [69.5, 42.5],
            [73.2, 43.2], [73.2, 40.5], [71.0, 39.5], [68.5, 38.0],
            [66.5, 37.3], [62.0, 35.5], [58.5, 37.0], [56.0, 38.5],
            [55.5, 41.2], [56.0, 41.2]
        ];

        // Major cities with coordinates
        const cities = [
            { name: 'Tashkent', lon: 69.25, lat: 41.3, x: 550, y: 220 },
            { name: 'Samarkand', lon: 66.95, lat: 39.65, x: 450, y: 350 },
            { name: 'Bukhara', lon: 64.43, lat: 39.77, x: 380, y: 340 },
            { name: 'Fergana', lon: 71.78, lat: 40.38, x: 630, y: 310 },
            { name: 'Nukus', lon: 59.61, lat: 42.45, x: 230, y: 130 },
            { name: 'Khiva', lon: 60.36, lat: 41.38, x: 260, y: 220 },
            { name: 'Termez', lon: 67.28, lat: 37.23, x: 470, y: 520 },
            { name: 'Namangan', lon: 71.67, lat: 41.0, x: 625, y: 240 }
        ];

        // Topographic regions
        const regions = [
            {
                name: 'Tian Shan\nMountains',
                points: [[620, 180], [720, 200], [720, 350], [640, 330], [620, 180]],
                color: '#8B4513',
                label: { x: 670, y: 260 }
            },
            {
                name: 'Pamir-Alay\nRange',
                points: [[450, 450], [580, 520], [520, 550], [420, 500], [450, 450]],
                color: '#A0522D',
                label: { x: 500, y: 500 }
            },
            {
                name: 'Fergana\nValley',
                points: [[600, 280], [680, 270], [690, 340], [620, 350], [600, 280]],
                color: '#D2691E',
                label: { x: 640, y: 310 }
            },
            {
                name: 'Kyzylkum\nDesert',
                points: [[300, 250], [550, 240], [530, 400], [350, 420], [300, 250]],
                color: '#DAA520',
                label: { x: 420, y: 320 }
            },
            {
                name: 'Ustyurt\nPlateau',
                points: [[150, 200], [280, 180], [290, 300], [170, 320], [150, 200]],
                color: '#DEB887',
                label: { x: 215, y: 250 }
            },
            {
                name: 'Amu Darya\nValley',
                points: [[280, 350], [400, 480], [380, 500], [260, 370], [280, 350]],
                color: '#90EE90',
                label: { x: 330, y: 420 }
            },
            {
                name: 'Aral Sea\nBasin',
                points: [[150, 80], [280, 60], [300, 160], [180, 180], [150, 80]],
                color: '#4682B4',
                label: { x: 220, y: 120 }
            }
        ];

        // Draw 2D map
        const svg = document.getElementById('svg-map');
        const svgNS = 'http://www.w3.org/2000/svg';

        // Draw regions
        regions.forEach(region => {
            const polygon = document.createElementNS(svgNS, 'polygon');
            polygon.setAttribute('points', region.points.map(p => p.join(',')).join(' '));
            polygon.setAttribute('fill', region.color);
            polygon.setAttribute('class', 'topography-region');
            svg.appendChild(polygon);

            // Add region label
            const text = document.createElementNS(svgNS, 'text');
            text.setAttribute('x', region.label.x);
            text.setAttribute('y', region.label.y);
            text.setAttribute('text-anchor', 'middle');
            text.setAttribute('fill', 'white');
            text.setAttribute('font-size', '14');
            text.setAttribute('font-weight', 'bold');
            text.setAttribute('style', 'text-shadow: 2px 2px 4px rgba(0,0,0,0.8);');

            const lines = region.name.split('\n');
            lines.forEach((line, i) => {
                const tspan = document.createElementNS(svgNS, 'tspan');
                tspan.setAttribute('x', region.label.x);
                tspan.setAttribute('dy', i === 0 ? 0 : 16);
                tspan.textContent = line;
                text.appendChild(tspan);
            });
            svg.appendChild(text);
        });

        // Draw country boundary
        const boundaryPath = regions.flatMap(r => r.points);
        const hull = document.createElementNS(svgNS, 'path');
        const pathData = `M 100,50 L 720,50 L 720,580 L 500,580 L 420,540 L 300,420 L 200,400 L 150,350 L 100,200 Z`;
        hull.setAttribute('d', pathData);
        hull.setAttribute('class', 'country-boundary');
        svg.appendChild(hull);

        // Draw cities
        cities.forEach(city => {
            const circle = document.createElementNS(svgNS, 'circle');
            circle.setAttribute('cx', city.x);
            circle.setAttribute('cy', city.y);
            circle.setAttribute('r', 4);
            circle.setAttribute('fill', '#e94560');
            circle.setAttribute('stroke', 'white');
            circle.setAttribute('stroke-width', 2);
            svg.appendChild(circle);

            const text = document.createElementNS(svgNS, 'text');
            text.setAttribute('x', city.x + 8);
            text.setAttribute('y', city.y - 8);
            text.setAttribute('fill', 'white');
            text.setAttribute('font-size', '12');
            text.setAttribute('font-weight', '600');
            text.setAttribute('style', 'text-shadow: 1px 1px 3px rgba(0,0,0,0.9);');
            text.textContent = city.name;
            svg.appendChild(text);
        });

        // ===== 3D TERRAIN =====
        const container3d = document.getElementById('map-3d');
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0f3460);
        scene.fog = new THREE.Fog(0x0f3460, 150, 400);

        const camera = new THREE.PerspectiveCamera(
            50,
            container3d.clientWidth / container3d.clientHeight,
            0.1,
            1000
        );
        camera.position.set(-80, 100, 120);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(container3d.clientWidth, container3d.clientHeight);
        renderer.shadowMap.enabled = true;
        container3d.appendChild(renderer.domElement);

        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.minDistance = 50;
        controls.maxDistance = 300;
        controls.maxPolarAngle = Math.PI / 2.2;

        // Lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.7);
        directionalLight.position.set(100, 150, 50);
        directionalLight.castShadow = true;
        scene.add(directionalLight);

        const fillLight = new THREE.DirectionalLight(0x4682B4, 0.3);
        fillLight.position.set(-50, 50, -50);
        scene.add(fillLight);

        // Create Uzbekistan-shaped terrain
        function createUzbekistanTerrain() {
            const width = 140;
            const depth = 100;
            const geometry = new THREE.PlaneGeometry(width, depth, 139, 99);
            const vertices = geometry.attributes.position.array;

            // Generate realistic elevation based on actual geography
            for (let i = 0; i < vertices.length / 3; i++) {
                const x = vertices[i * 3];
                const y = vertices[i * 3 + 1];

                // Normalized coordinates (0 to 1)
                const nx = (x / width + 0.5);
                const ny = (y / depth + 0.5);

                let elevation = 0;

                // Tian Shan Mountains (East) - highest
                if (nx > 0.65 && ny < 0.7) {
                    const distFromPeak = Math.hypot(nx - 0.85, ny - 0.35);
                    elevation = Math.max(0, 80 - distFromPeak * 100);
                }

                // Pamir-Alay (South)
                if (ny > 0.7 && nx > 0.4) {
                    const distFromRange = Math.hypot(nx - 0.6, ny - 0.85);
                    elevation = Math.max(elevation, 60 - distFromRange * 80);
                }

                // Fergana Valley (East-center) - depression between mountains
                if (nx > 0.6 && nx < 0.75 && ny > 0.35 && ny < 0.6) {
                    elevation = Math.min(elevation, 25);
                }

                // Kyzylkum Desert (Center) - moderate elevation
                if (nx > 0.3 && nx < 0.65 && ny > 0.3 && ny < 0.65) {
                    elevation = Math.max(elevation, 15 + Math.random() * 5);
                }

                // Ustyurt Plateau (West) - flat elevated
                if (nx < 0.35 && ny > 0.25 && ny < 0.55) {
                    elevation = Math.max(elevation, 12);
                }

                // Aral Sea Basin (Northwest) - lowest point
                if (nx < 0.3 && ny < 0.25) {
                    elevation = 2;
                }

                // River valleys - depressions
                if (nx > 0.25 && nx < 0.4 && ny > 0.5) {
                    elevation = Math.max(elevation * 0.6, 8);
                }

                // Add natural variation
                elevation += Math.random() * 2;

                vertices[i * 3 + 2] = elevation;
            }

            geometry.computeVertexNormals();

            // Color based on elevation
            const colors = new Float32Array(vertices.length);
            for (let i = 0; i < vertices.length / 3; i++) {
                const elevation = vertices[i * 3 + 2];
                let color;

                if (elevation < 5) {
                    color = new THREE.Color(0x4682B4); // Blue - Aral Sea
                } else if (elevation < 15) {
                    color = new THREE.Color(0x90EE90); // Light green - valleys
                } else if (elevation < 25) {
                    color = new THREE.Color(0xDAA520); // Gold - desert
                } else if (elevation < 40) {
                    color = new THREE.Color(0xD2691E); // Chocolate - foothills
                } else if (elevation < 60) {
                    color = new THREE.Color(0xA0522D); // Sienna - mountains
                } else {
                    color = new THREE.Color(0x8B4513); // Saddle brown - peaks
                }

                colors[i * 3] = color.r;
                colors[i * 3 + 1] = color.g;
                colors[i * 3 + 2] = color.b;
            }

            geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));

            const material = new THREE.MeshStandardMaterial({
                vertexColors: true,
                flatShading: false,
                roughness: 0.9,
                metalness: 0.1
            });

            const mesh = new THREE.Mesh(geometry, material);
            mesh.rotation.x = -Math.PI / 2;
            mesh.receiveShadow = true;
            mesh.castShadow = true;

            return mesh;
        }

        const terrain = createUzbekistanTerrain();
        scene.add(terrain);

        // Add city markers in 3D
        cities.forEach(city => {
            // Approximate 3D position based on 2D coordinates
            const x = (city.x - 400) / 5;
            const z = (city.y - 300) / 5;

            const markerGeometry = new THREE.SphereGeometry(1, 16, 16);
            const markerMaterial = new THREE.MeshStandardMaterial({
                color: 0xe94560,
                emissive: 0xe94560,
                emissiveIntensity: 0.5
            });
            const marker = new THREE.Mesh(markerGeometry, markerMaterial);
            marker.position.set(x, 10, z);
            scene.add(marker);

            // Add label pole
            const poleGeometry = new THREE.CylinderGeometry(0.1, 0.1, 10, 8);
            const poleMaterial = new THREE.MeshStandardMaterial({ color: 0xffffff });
            const pole = new THREE.Mesh(poleGeometry, poleMaterial);
            pole.position.set(x, 5, z);
            scene.add(pole);
        });

        // Grid helper
        const gridHelper = new THREE.GridHelper(200, 30, 0x444444, 0x222222);
        gridHelper.position.y = -2;
        scene.add(gridHelper);

        // Axes helper
        const axesHelper = new THREE.AxesHelper(50);
        axesHelper.position.y = 0;
        scene.add(axesHelper);

        // Animation
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        // Handle resize
        window.addEventListener('resize', () => {
            const width = container3d.clientWidth;
            const height = container3d.clientHeight;
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            renderer.setSize(width, height);
        });

        animate();
    </script>
</body>
</html>
